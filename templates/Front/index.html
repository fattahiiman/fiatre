{% extends 'Layouts/front-master.html' %}
{% load static %}

{% block content %}
    <main>
        <div class="boom" style="margin-bottom: 30px;  ">
            <div class="container-fluid mt-5" style="margin-top: 50px;">
                <div class="row justify-content-center">

                    {% if not request.user.is_authenticated %}
                        <div class="col-md-4 mt-5">
                            <div class="login-card ">
                                <form id="register_form">
                                    {% csrf_token %}

                                    <p style="font-family: Shabnam;">
                                        لطفا شماره تلفن همراه خود را وارد نمایید <br> مثال: ********0912
                                    </p>
                                    <input type="text" required name="phone" id="phone" class="form-control" placeholder="شماره تلفن همراه">
                                    <input type="password" required name="password" id="password" class="form-control" placeholder="رمز عبور">
                                    <input type="password" required name="password2" id="password2" class="form-control" placeholder="تکرار رمز عبور">
                                    <div class="form-check">
                                        <input id="remember_me" name="remember_me" type="checkbox"/>
                                        <label for="remember_me" style="font-family: Shabnam;">مرا بخاطر بسپار</label>
                                    </div>
                                    <a href="{% url 'login' %}" style="font-family: Shabnam;">حساب کاربری دارید؟وارد
                                        شوید</a>
                                    <div class="button-login">
                                        <button type="submit">
                                            ثبت نام
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    {% endif %}

                </div>

                <div class="main_container" style=" margin-top: 80px;">
                    <section class="category_row">

                        {% for item in categories %}
                            <a href="{% url 'category' item.slug %}" class="box">
                                <div class="box_thumbnail">
                                    <div class="total_video">
                                        {{ item.episodes.count }} ویدئو
                                    </div>
                                    <img data-lazyloaded="1"
                                         src="{{ item.image.url }}"
                                         data-src="{{ item.image.url }}"
                                         alt="{{ item.name }}" class="litespeed-loaded"
                                         data-was-processed="true">
                                </div>
                                <div class="content">
                                    <h2 class="title">{{ item.name }}</h2>
                                    <div class="excerpt">
                                        <p>ویدئوهای آموزشی و تحیلی {{ item.name }} را در این صفحه با اینترنت نیم بها
                                            ببینید</p>
                                    </div>
                                </div>
                            </a>
                        {% endfor %}

                    </section>
                    <div class="about res-film">
                        <div class="inset">
                            <div class="embed-video">
                                <div class="tv_img">
                                    <img src="{{ embed_advertise_image }}" alt="tv mockup">
                                    <div class="teaser">
                                        <img src="{{ embed_advertise_gif }}" alt="teaser gif"></div>
                                </div>
                            </div>
                            <div class="text">
                                <div class="logo">
                                    <svg x="0px" y="0px" viewBox="0 0 86.8 50.5"
                                         style="enable-background:new 0 0 86.8 50.5;" xml:space="preserve">
                                            <g>
                                                <path class="st0"
                                                      d="M86.5,33.9c-1.9,0-2.2,0.3-2.7,1.9c-0.4,1.4-1.3,2.5-2.4,3.3c-1,0.7-2.1,1.2-3,2c-1.2,1.1-2.5,1.1-3.9,0.9 c-1-0.2-2.1-0.2-3.2-0.4c-0.7-0.2-1.5-0.5-2.1-0.9C68,40,66.9,39,65.3,39.2c-0.2,0-0.5-0.2-0.7-0.4c-1.5-1.3-2.9-2.7-4.4-4 c-0.8-0.8-1.7-1-2.6-0.4c-0.8,0.5-1.6,1.1-2.3,1.8c-2.8,3-7.6,3.7-10.9,1.2c-3-2.2-5.3-5-5.6-8.9c-0.3-3.3-0.4-6.7-0.4-10 c0-3.2,0.5-6.3-0.4-9.4c-0.5-1.7-0.3-3.2,0.4-4.8c0.5-1.2,0.9-2.5,1.3-3.7c0.2-0.6,0.5-0.8,1.1-0.7h0.1c2.7,0.3,3.1,0.9,3.3,3.5 c0.4,4.6-0.1,9.2-0.5,13.8c-0.3,3.7-0.8,7.5-0.3,11.2c0.1,0.8,0.3,1.6,0.6,2.4c0.8,2.3,3,3.2,5.2,1.9c2.5-1.5,4.4-3.6,5.6-6.2 c0.4-0.9,0.8-1.7,1.2-2.5c0.3-0.6,0.9-0.9,1.6-0.8c2.6,0.4,4.3,2.3,4.6,5c0.3,2.8,1.4,5.2,4.3,6.4c3,1.3,6,1.6,9.2,1.1 c0.7-0.1,0.9-0.5,0.7-1c-0.3-0.6-0.7-1.2-1.2-1.5c-1-0.6-2.1-1-3.1-1.6c-1.2-0.7-2.5-1.5-3.6-2.3c-0.6-0.4-0.9-1.2-1.3-1.9 c-0.5-1-0.4-2,0.5-2.9c1.6-1.4,2.6-3.3,3.6-5.1c0.3-0.6,0.5-1.2,0.7-1.9c0.1-0.5,0-1-0.5-1.3c-0.8-0.6-0.9-1.4-0.6-2.3 c0.9-2.9,3.8-4.1,6.5-2.6c2.3,1.3,3.9,3.3,4.8,5.7c1.1,3.1,2,6.3,2.9,9.5c0.5,1.9,1,3.8,1.4,5.7C86.7,32.8,86.5,33.4,86.5,33.9z M80.2,27.1L80.2,27.1c0-0.6-0.1-1.2-0.2-1.8c-0.4-2-1-4-2.5-5.6c-1.2-1.3-2.2-1.1-2.9,0.5c-0.1,0.4-0.3,0.7-0.5,1 c-1.4,2-0.8,4.8,1.4,5.9c1.2,0.6,2.6,0.8,3.9,1.2c0.5,0.1,0.7-0.1,0.7-0.6C80.2,27.6,80.2,27.3,80.2,27.1z">
                                                </path>
                                                <path class="st0"
                                                      d="M28.8,12.3c0.3,0.9,0.5,1.7,0.8,2.5s0.7,1.4,1.5,1.8c0.5,0.3,1,1,1.2,1.6c1.1,3,2.3,5.9,3.3,9 c0.6,1.9,0.6,4,1,5.9c0.2,0.9,0,1.6-0.7,2.3c-1,1.1-1.9,2.3-2.9,3.3c-1.2,1.3-2.6,2.3-4.5,2.5c-0.8,0.1-1.8-0.1-2.5-0.4 c-1.4-0.7-2.8-1.6-4.5-1.5c-0.4,0-0.8-0.5-1.2-0.8c-0.5-0.4-1-0.9-1.6-1.5c-0.1,0.2-0.1,0.3-0.1,0.4c0.2,2.9-1.5,5.3-2.4,7.9 c-0.1,0.2-0.4,0.3-0.6,0.5c-0.5,0.4-1.2,0.6-1.5,1.1c-1.2,1.9-2.9,2.9-5.1,3.1c-1.1,0.1-2.1,0.2-3.2,0.2c-0.2,0-0.6-0.2-0.7-0.4 c-0.2-0.7-0.6-0.6-1.1-0.5c-0.8,0.1-1.7,0.2-2.6,0.1c-0.4,0-0.8-0.3-1.1-0.5C-0.1,48.7,0,48.3,0.6,48c0.3-0.2,0.7-0.3,1.1-0.4 c4.6-1.5,8.3-4.1,10.9-8.2c1.6-2.6,2.1-5.3,0.8-8.2c-0.6-1.4-1.2-2.8-2-4.1c-0.5-0.8-1.4-1.5-2.1-2.2C9.1,24.8,9,24.8,9,24.7 c-0.2-1-0.4-2.1-0.4-3.2c0-1,0.3-1.9,0.4-2.9c0.1-0.9,0.6-1.3,1.5-1.5c1.1-0.2,2.2-0.4,3.4-0.6c1.7,2.3,2.8,5,3.5,7.9 c0.7,2.7,1.6,5.4,2.5,8.1c0.2,0.5,0.6,1,1,1.3c1.7,1.3,3.5,2.2,5.8,1.8c2.2-0.4,3.8-2.2,3.6-4.2c-0.1-0.7-0.3-1.4-0.7-2 c-1.3-1.8-2.6-3.5-3.9-5.3c-0.3-0.4-0.5-1-0.6-1.6c-0.3-1-0.6-2-0.8-3.1c-0.3-1.9,0.1-3.8,0.9-5.6c0.2-0.5,0.8-0.9,1.3-1.2 C27.2,12.5,28,12.5,28.8,12.3z">
                                                </path>
                                                <path class="st0"
                                                      d="M47.6,42c0.4,0.2,0.6,0.3,0.8,0.4c0.6,0.3,1.3,0.6,1.9,1c1.4,0.9,2.7,0.7,4.1,0.2c0.2-0.1,0.4-0.2,0.5-0.3 s0.2-0.3,0.3-0.3c1.4-0.2,1.5-1.8,2.6-2.3c0.3-0.1,0.8-0.3,1.1-0.2c1.3,0.2,2.3,1,3,2.1c0.3,0.5,0.4,0.9-0.1,1.3 c-0.2,0.1-0.2,0.5-0.3,0.7c-0.3,0.6-0.6,1.2-1,1.7c-0.6,0.7-1.1,0.7-1.8,0c-1.3-1.2-3.1-1.2-4.5-0.1c-1.1,0.9-2.3,1.9-3.5,2.8 c-0.3,0.2-0.8,0.3-1.2,0.2c-1.5-0.4-2.8-1.5-3.3-2.9c-0.4-1-0.1-2.4,0.1-3.5C46.4,42.5,47.2,42.3,47.6,42z">
                                                </path>
                                                <path class="st0"
                                                      d="M18.3,7.8c0.3-1.1,0.4-2.1,0.7-3c0.2-0.7,1.3-1,2-0.7c1,0.5,2.1,1,3.1,1.5c1,0.4,2.9,0,3.6-0.9 c0,0,0-0.1,0.1-0.1c1.4-0.1,1.4-1.8,2.5-2.2c0.4-0.1,0.8-0.3,1.2-0.2c1.3,0.2,2.2,1,2.9,2.1c0.3,0.4,0.4,0.8-0.1,1.2 c-0.2,0.2-0.2,0.5-0.4,0.8c-0.3,0.6-0.5,1.2-1,1.7s-1,0.8-1.7,0c-1.1-1.2-3.1-1.2-4.3-0.1c-1.1,0.9-2.3,1.9-3.5,2.8 c-0.2,0.2-0.7,0.3-0.9,0.2c-1.6-0.4-2.9-1.2-3.9-2.5C18.4,8.2,18.3,7.9,18.3,7.8z">
                                                </path>
                                                <path class="st0"
                                                      d="M73.1,0.6c1.8,0.3,2.9,1.2,3.7,2.5C76.9,3.4,77,3.7,77,4c0.1,1-1.8,3.9-2.7,4.3c-0.2,0.1-0.6-0.1-0.9-0.2 c-0.4-0.2-0.8-0.5-1.3-0.6c-1.3-0.2-2.8-2.2-2.6-3.5c0-0.2,0.2-0.5,0.4-0.7c0.7-0.8,1.4-1.5,2.2-2.2C72.4,0.7,72.8,0.7,73.1,0.6z">
                                                </path>
                                            </g>
                                        </svg>
                                </div>
                                <p>{{ advertise_text }}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
{% endblock %}

{% block Scripts %}
    <script>
        // CSRF TOKEN //
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        function showErrorToast(error) {
            toastr.options = {
                "closeButton": true,
                "debug": false,
                "newestOnTop": false,
                "progressBar": true,
                "positionClass": "toast-bottom-center",
                "preventDuplicates": false,
                "showDuration": "2000",
                "hideDuration": "500",
                "timeOut": "5000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            }
            toastr.error(error)
        }

        function showSuccessToast(message) {
            toastr.options = {
                "closeButton": true,
                "debug": false,
                "newestOnTop": false,
                "progressBar": true,
                "positionClass": "toast-bottom-center",
                "preventDuplicates": false,
                "showDuration": "2000",
                "hideDuration": "500",
                "timeOut": "5000",
                "extendedTimeOut": "1000",
                "showEasing": "swing",
                "hideEasing": "linear",
                "showMethod": "fadeIn",
                "hideMethod": "fadeOut"
            }
            toastr.success(message)
        }

        //////////////////////////////////////////////////////////////////////////////////////////////////

        $("#register_form").on('submit', function (event) {
            event.preventDefault()

            var formData = $(this).serialize()

            const csrftoken = getCookie('csrftoken');

            $.ajax({
                url: {% url 'register' %},
                headers: {'X-CSRFToken': csrftoken},
                method: "POST",
                data: formData,
                dataType: 'json',
                async: true,
                success: function (data) {

                    if (data['status'] === 'OK') {

                        showSuccessToast(data['message'])

                        setTimeout(() => {
                            window.location.href =
                            {% url 'account' %}
                        }, 3000);


                    } else {
                        if (data['errors']['__all__']) {
                            for (const item in data['errors']['__all__']) {
                                showErrorToast(data['errors']['__all__'][item])
                                break
                            }
                        } else {
                            for (const item in data['errors']) {
                                showErrorToast(item + ' : ' + data['errors'][item])
                                break
                            }
                        }

                    }
                },
            });

        });
    </script>
{% endblock %}